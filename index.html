<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DSS SenzTech ‚Äì Prediksi Proyek & SDM</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
  }
  
  .navbar {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 20px rgba(0,0,0,0.1);
    padding: 0;
    position: sticky;
    top: 0;
    z-index: 1000;
  }
  
  .nav-container {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 24px;
  }
  
  .nav-brand {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 0;
  }
  
  .nav-brand h1 {
    color: #667eea;
    font-size: 24px;
    font-weight: 700;
  }
  
  .nav-menu {
    display: flex;
    gap: 8px;
    list-style: none;
  }
  
  .nav-item {
    padding: 12px 20px;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s;
    color: #333;
    font-weight: 500;
  }
  
  .nav-item:hover {
    background: #f0f0f0;
    color: #667eea;
  }
  
  .nav-item.active {
    background: #667eea;
    color: white;
  }
  
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 32px 24px;
  }
  
  .page {
    display: none;
    animation: fadeIn 0.3s;
  }
  
  .page.active {
    display: block;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .card {
    background: white;
    border-radius: 16px;
    padding: 28px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    margin-bottom: 24px;
  }
  
  .card h2 {
    color: #667eea;
    margin-bottom: 20px;
    font-size: 24px;
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
  }
  
  .stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }
  
  .stat-card h3 {
    font-size: 14px;
    opacity: 0.9;
    margin-bottom: 8px;
  }
  
  .stat-card .value {
    font-size: 32px;
    font-weight: 700;
  }
  
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
  }
  
  th, td {
    padding: 14px;
    text-align: left;
    border-bottom: 1px solid #e0e0e0;
  }
  
  th {
    background: #f8f9fa;
    color: #667eea;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 12px;
    letter-spacing: 0.5px;
  }
  
  tr:hover {
    background: #f8f9fa;
  }
  
  .btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    font-size: 14px;
  }
  
  .btn-primary {
    background: #667eea;
    color: white;
  }
  
  .btn-primary:hover {
    background: #5568d3;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }
  
  .btn-success {
    background: #10b981;
    color: white;
  }
  
  .btn-success:hover {
    background: #059669;
  }
  
  .btn-danger {
    background: #ef4444;
    color: white;
  }
  
  .btn-danger:hover {
    background: #dc2626;
  }
  
  .btn-warning {
    background: #f59e0b;
    color: white;
  }
  
  .btn-warning:hover {
    background: #d97706;
  }
  
  .btn-sm {
    padding: 6px 12px;
    font-size: 12px;
  }
  
  .form-group {
    margin-bottom: 20px;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 8px;
    color: #333;
    font-weight: 600;
  }
  
  .form-control {
    width: 100%;
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.3s;
  }
  
  .form-control:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 2000;
    animation: fadeIn 0.3s;
  }
  
  .modal.active {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  .modal-content {
    background: white;
    padding: 32px;
    border-radius: 16px;
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.3s;
  }
  
  @keyframes slideUp {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
  }
  
  .modal-header h3 {
    color: #667eea;
    font-size: 20px;
  }
  
  .close-btn {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #999;
    padding: 0;
    width: 32px;
    height: 32px;
    line-height: 32px;
  }
  
  .close-btn:hover {
    color: #333;
  }
  
  .result-box {
    background: linear-gradient(135deg, #f0f4ff 0%, #f8f0ff 100%);
    padding: 24px;
    border-radius: 12px;
    border-left: 4px solid #667eea;
  }
  
  .result-box h3 {
    color: #667eea;
    margin-bottom: 16px;
  }
  
  .result-item {
    margin-bottom: 12px;
    font-size: 16px;
  }
  
  .result-item strong {
    color: #333;
  }
  
  .action-buttons {
    display: flex;
    gap: 8px;
  }
  
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #999;
  }
  
  .empty-state svg {
    width: 120px;
    height: 120px;
    margin-bottom: 20px;
    opacity: 0.3;
  }
</style>
</head>
<body>

<nav class="navbar">
  <div class="nav-container">
    <div class="nav-brand">
      <h1>üöÄ SenzTech DSS</h1>
    </div>
    <ul class="nav-menu">
      <li class="nav-item active" onclick="changePage('dashboard')">Dashboard</li>
      <li class="nav-item" onclick="changePage('projects')">Data Proyek</li>
      <li class="nav-item" onclick="changePage('sdm')">Manajemen SDM</li>
      <li class="nav-item" onclick="changePage('prediction')">Prediksi & Analisis</li>
      <li class="nav-item" onclick="changePage('reports')">Laporan</li>
    </ul>
  </div>
</nav>

<div class="container">
  <!-- Dashboard Page -->
  <div id="dashboard" class="page active">
    <div class="stats-grid">
      <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <h3>Total Proyek</h3>
        <div class="value" id="totalProjects">0</div>
        <p style="font-size: 12px; margin-top: 8px; opacity: 0.9;">üìä Keseluruhan proyek</p>
      </div>
      <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
        <h3>Total SDM</h3>
        <div class="value" id="totalSDM">0</div>
        <p style="font-size: 12px; margin-top: 8px; opacity: 0.9;">üë• SDM aktif</p>
      </div>
      <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
        <h3>Proyek Bulan Ini</h3>
        <div class="value" id="monthProjects">0</div>
        <p style="font-size: 12px; margin-top: 8px; opacity: 0.9;">üìÖ Periode berjalan</p>
      </div>
      <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
        <h3>Rata-rata Proyek</h3>
        <div class="value" id="avgProjects">0</div>
        <p style="font-size: 12px; margin-top: 8px; opacity: 0.9;">üìà Per bulan</p>
      </div>
    </div>
    
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 24px;">
      <div class="card">
        <h2>üìà Tren Proyek Bulanan</h2>
        <canvas id="projectTrendChart" style="max-height: 300px;"></canvas>
      </div>
      
      <div class="card">
        <h2>üë• Distribusi SDM</h2>
        <canvas id="sdmDistributionChart" style="max-height: 300px;"></canvas>
      </div>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
      <div class="card">
        <h2>üìä Status SDM</h2>
        <canvas id="sdmStatusChart" style="max-height: 250px;"></canvas>
      </div>
      
      <div class="card">
        <h2>üéØ Performa Proyek</h2>
        <div id="performanceMetrics" style="padding: 20px 0;">
          <div style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span style="font-weight: 600; color: #667eea;">Tingkat Produktivitas</span>
              <span id="productivityRate" style="font-weight: 700;">0%</span>
            </div>
            <div style="background: #e0e0e0; height: 12px; border-radius: 6px; overflow: hidden;">
              <div id="productivityBar" style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: 0%; transition: width 1s;"></div>
            </div>
          </div>
          
          <div style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span style="font-weight: 600; color: #f5576c;">Beban Kerja Tim</span>
              <span id="workloadRate" style="font-weight: 700;">0%</span>
            </div>
            <div style="background: #e0e0e0; height: 12px; border-radius: 6px; overflow: hidden;">
              <div id="workloadBar" style="background: linear-gradient(90deg, #f093fb, #f5576c); height: 100%; width: 0%; transition: width 1s;"></div>
            </div>
          </div>
          
          <div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span style="font-weight: 600; color: #43e97b;">Kapasitas Tersedia</span>
              <span id="capacityRate" style="font-weight: 700;">0%</span>
            </div>
            <div style="background: #e0e0e0; height: 12px; border-radius: 6px; overflow: hidden;">
              <div id="capacityBar" style="background: linear-gradient(90deg, #43e97b, #38f9d7); height: 100%; width: 0%; transition: width 1s;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
      <h2 style="color: #667eea; margin-bottom: 20px;">üöÄ Ringkasan Sistem Decision Support</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
        <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #667eea;">
          <div style="font-size: 24px; margin-bottom: 8px;">üìä</div>
          <h3 style="color: #333; margin-bottom: 8px; font-size: 16px;">Data Management</h3>
          <p style="color: #666; font-size: 14px; line-height: 1.6;">Kelola data proyek dan historis dengan mudah</p>
        </div>
        <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #f5576c;">
          <div style="font-size: 24px; margin-bottom: 8px;">üë•</div>
          <h3 style="color: #333; margin-bottom: 8px; font-size: 16px;">SDM Management</h3>
          <p style="color: #666; font-size: 14px; line-height: 1.6;">Manajemen tim dan sumber daya manusia</p>
        </div>
        <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #4facfe;">
          <div style="font-size: 24px; margin-bottom: 8px;">üìà</div>
          <h3 style="color: #333; margin-bottom: 8px; font-size: 16px;">Prediction Engine</h3>
          <p style="color: #666; font-size: 14px; line-height: 1.6;">Prediksi jumlah proyek mendatang akurat</p>
        </div>
        <div style="background: white; padding: 20px; border-radius: 12px; border-left: 4px solid #43e97b;">
          <div style="font-size: 24px; margin-bottom: 8px;">üí°</div>
          <h3 style="color: #333; margin-bottom: 8px; font-size: 16px;">Smart Recommendations</h3>
          <p style="color: #666; font-size: 14px; line-height: 1.6;">Rekomendasi kebutuhan SDM optimal</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Projects Page -->
  <div id="projects" class="page">
    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>Data Proyek</h2>
        <button class="btn btn-primary" onclick="openProjectModal()">+ Tambah Proyek</button>
      </div>
      
      <table id="projectTable">
        <thead>
          <tr>
            <th>Bulan</th>
            <th>Tahun</th>
            <th>Jumlah Proyek</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="projectTableBody">
          <tr>
            <td colspan="4" class="empty-state">Belum ada data proyek</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- SDM Page -->
  <div id="sdm" class="page">
    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>Manajemen SDM</h2>
        <button class="btn btn-primary" onclick="openSDMModal()">+ Tambah SDM</button>
      </div>
      
      <table id="sdmTable">
        <thead>
          <tr>
            <th>Nama</th>
            <th>Posisi</th>
            <th>Status</th>
            <th>Email</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="sdmTableBody">
          <tr>
            <td colspan="5" class="empty-state">Belum ada data SDM</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Prediction Page -->
  <div id="prediction" class="page">
    <div class="card">
      <h2>Prediksi & Analisis</h2>
      
      <div class="form-group">
        <label>Rata-rata SDM per Proyek</label>
        <input type="number" class="form-control" id="sdmPerProyek" value="2" min="1">
      </div>
      
      <button class="btn btn-primary" onclick="calculatePrediction()">üîÆ Hitung Prediksi</button>
      
      <div id="predictionResult" style="margin-top: 24px;"></div>
    </div>
  </div>

  <!-- Reports Page -->
  <div id="reports" class="page">
    <div class="card">
      <h2>Laporan & Statistik</h2>
      
      <div id="reportContent">
        <p style="color: #999;">Klik tombol di bawah untuk generate laporan</p>
      </div>
      
      <button class="btn btn-success" onclick="generateReport()" style="margin-top: 20px;">üìÑ Generate Laporan</button>
    </div>
  </div>
</div>

<!-- Modal Proyek -->
<div id="projectModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="projectModalTitle">Tambah Proyek</h3>
      <button class="close-btn" onclick="closeProjectModal()">&times;</button>
    </div>
    <form id="projectForm" onsubmit="saveProject(event)">
      <input type="hidden" id="projectId">
      <div class="form-group">
        <label>Bulan</label>
        <select class="form-control" id="projectMonth" required>
          <option value="Januari">Januari</option>
          <option value="Februari">Februari</option>
          <option value="Maret">Maret</option>
          <option value="April">April</option>
          <option value="Mei">Mei</option>
          <option value="Juni">Juni</option>
          <option value="Juli">Juli</option>
          <option value="Agustus">Agustus</option>
          <option value="September">September</option>
          <option value="Oktober">Oktober</option>
          <option value="November">November</option>
          <option value="Desember">Desember</option>
        </select>
      </div>
      <div class="form-group">
        <label>Tahun</label>
        <input type="number" class="form-control" id="projectYear" required min="2020" max="2030">
      </div>
      <div class="form-group">
        <label>Jumlah Proyek</label>
        <input type="number" class="form-control" id="projectCount" required min="1">
      </div>
      <button type="submit" class="btn btn-primary" style="width: 100%;">Simpan</button>
    </form>
  </div>
</div>

<!-- Modal SDM -->
<div id="sdmModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="sdmModalTitle">Tambah SDM</h3>
      <button class="close-btn" onclick="closeSDMModal()">&times;</button>
    </div>
    <form id="sdmForm" onsubmit="saveSDM(event)">
      <input type="hidden" id="sdmId">
      <div class="form-group">
        <label>Nama Lengkap</label>
        <input type="text" class="form-control" id="sdmName" required>
      </div>
      <div class="form-group">
        <label>Posisi</label>
        <select class="form-control" id="sdmPosition" required>
          <option value="Developer">Developer</option>
          <option value="Designer">Designer</option>
          <option value="Project Manager">Project Manager</option>
          <option value="QA Tester">QA Tester</option>
          <option value="DevOps">DevOps</option>
        </select>
      </div>
      <div class="form-group">
        <label>Status</label>
        <select class="form-control" id="sdmStatus" required>
          <option value="Aktif">Aktif</option>
          <option value="Cuti">Cuti</option>
          <option value="Tidak Aktif">Tidak Aktif</option>
        </select>
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" class="form-control" id="sdmEmail" required>
      </div>
      <button type="submit" class="btn btn-primary" style="width: 100%;">Simpan</button>
    </form>
  </div>
</div>

<script>
// Data Storage
let projects = [];
let sdmData = [];
let charts = {};

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  loadData();
  updateDashboard();
  initCharts();
  document.getElementById('projectYear').value = new Date().getFullYear();
});

function loadData() {
  projects = [
    {id: 1, month: 'Januari', year: 2025, count: 8},
    {id: 2, month: 'Februari', year: 2025, count: 10},
    {id: 3, month: 'Maret', year: 2025, count: 7},
    {id: 4, month: 'April', year: 2025, count: 12},
    {id: 5, month: 'Mei', year: 2025, count: 9},
    {id: 6, month: 'Juni', year: 2025, count: 11},
    {id: 7, month: 'Juli', year: 2025, count: 13},
    {id: 8, month: 'Agustus', year: 2025, count: 9}
  ];
  
  sdmData = [
    {id: 1, name: 'Budi Santoso', position: 'Developer', status: 'Aktif', email: 'budi@senztech.com'},
    {id: 2, name: 'Siti Nurhaliza', position: 'Designer', status: 'Aktif', email: 'siti@senztech.com'},
    {id: 3, name: 'Ahmad Rizki', position: 'Project Manager', status: 'Aktif', email: 'ahmad@senztech.com'},
    {id: 4, name: 'Dewi Lestari', position: 'Developer', status: 'Aktif', email: 'dewi@senztech.com'},
    {id: 5, name: 'Eko Prasetyo', position: 'QA Tester', status: 'Cuti', email: 'eko@senztech.com'},
    {id: 6, name: 'Fitri Handayani', position: 'DevOps', status: 'Aktif', email: 'fitri@senztech.com'}
  ];
  
  renderProjects();
  renderSDM();
  updateDashboard();
}

// Initialize Charts
function initCharts() {
  createProjectTrendChart();
  createSDMDistributionChart();
  createSDMStatusChart();
  updatePerformanceMetrics();
}

function createProjectTrendChart() {
  const ctx = document.getElementById('projectTrendChart').getContext('2d');
  
  const sortedProjects = [...projects].sort((a, b) => {
    if (a.year !== b.year) return a.year - b.year;
    const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
    return months.indexOf(a.month) - months.indexOf(b.month);
  });
  
  const labels = sortedProjects.map(p => `${p.month.substring(0, 3)} ${p.year}`);
  const data = sortedProjects.map(p => p.count);
  
  if (charts.projectTrend) {
    charts.projectTrend.destroy();
  }
  
  charts.projectTrend = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Jumlah Proyek',
        data: data,
        borderColor: '#667eea',
        backgroundColor: 'rgba(102, 126, 234, 0.1)',
        borderWidth: 3,
        fill: true,
        tension: 0.4,
        pointRadius: 5,
        pointBackgroundColor: '#667eea',
        pointBorderColor: '#fff',
        pointBorderWidth: 2,
        pointHoverRadius: 7
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          padding: 12,
          borderRadius: 8,
          titleFont: {
            size: 14,
            weight: 'bold'
          },
          bodyFont: {
            size: 13
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 2,
            font: {
              size: 12
            }
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.05)'
          }
        },
        x: {
          ticks: {
            font: {
              size: 11
            }
          },
          grid: {
            display: false
          }
        }
      }
    }
  });
}

function createSDMDistributionChart() {
  const ctx = document.getElementById('sdmDistributionChart').getContext('2d');
  
  const positionCount = {};
  sdmData.forEach(s => {
    positionCount[s.position] = (positionCount[s.position] || 0) + 1;
  });
  
  if (charts.sdmDistribution) {
    charts.sdmDistribution.destroy();
  }
  
  charts.sdmDistribution = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: Object.keys(positionCount),
      datasets: [{
        data: Object.values(positionCount),
        backgroundColor: [
          '#667eea',
          '#f5576c',
          '#4facfe',
          '#43e97b',
          '#fa709a'
        ],
        borderWidth: 3,
        borderColor: '#fff'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            padding: 15,
            font: {
              size: 11
            },
            usePointStyle: true,
            pointStyle: 'circle'
          }
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          padding: 12,
          borderRadius: 8
        }
      }
    }
  });
}

function createSDMStatusChart() {
  const ctx = document.getElementById('sdmStatusChart').getContext('2d');
  
  const statusCount = {
    'Aktif': 0,
    'Cuti': 0,
    'Tidak Aktif': 0
  };
  
  sdmData.forEach(s => {
    statusCount[s.status] = (statusCount[s.status] || 0) + 1;
  });
  
  if (charts.sdmStatus) {
    charts.sdmStatus.destroy();
  }
  
  charts.sdmStatus = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: Object.keys(statusCount),
      datasets: [{
        label: 'Jumlah SDM',
        data: Object.values(statusCount),
        backgroundColor: [
          '#43e97b',
          '#f59e0b',
          '#ef4444'
        ],
        borderRadius: 8,
        borderWidth: 0
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          padding: 12,
          borderRadius: 8
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 1,
            font: {
              size: 12
            }
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.05)'
          }
        },
        x: {
          grid: {
            display: false
          },
          ticks: {
            font: {
              size: 12
            }
          }
        }
      }
    }
  });
}

function updatePerformanceMetrics() {
  const totalProjects = projects.reduce((sum, p) => sum + p.count, 0);
  const activeSDM = sdmData.filter(s => s.status === 'Aktif').length;
  const avgProjectsPerMonth = projects.length > 0 ? totalProjects / projects.length : 0;
  
  // Produktivitas: Rata-rata proyek per SDM aktif
  const productivity = activeSDM > 0 ? Math.min((avgProjectsPerMonth / activeSDM) * 50, 100) : 0;
  
  // Beban kerja: Berdasarkan rasio proyek terhadap SDM
  const workload = activeSDM > 0 ? Math.min((avgProjectsPerMonth / activeSDM) * 40, 100) : 0;
  
  // Kapasitas: Sisa kapasitas tim
  const capacity = Math.max(100 - workload, 0);
  
  document.getElementById('productivityRate').textContent = Math.round(productivity) + '%';
  document.getElementById('productivityBar').style.width = productivity + '%';
  
  document.getElementById('workloadRate').textContent = Math.round(workload) + '%';
  document.getElementById('workloadBar').style.width = workload + '%';
  
  document.getElementById('capacityRate').textContent = Math.round(capacity) + '%';
  document.getElementById('capacityBar').style.width = capacity + '%';
}

// Navigation
function changePage(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  
  document.getElementById(pageId).classList.add('active');
  event.target.classList.add('active');
}

// Dashboard
function updateDashboard() {
  document.getElementById('totalProjects').textContent = projects.reduce((sum, p) => sum + p.count, 0);
  document.getElementById('totalSDM').textContent = sdmData.filter(s => s.status === 'Aktif').length;
  
  const currentMonth = new Date().toLocaleDateString('id-ID', {month: 'long'});
  const monthProject = projects.find(p => p.month === currentMonth);
  document.getElementById('monthProjects').textContent = monthProject ? monthProject.count : 0;
  
  const avg = projects.length > 0 ? Math.round(projects.reduce((sum, p) => sum + p.count, 0) / projects.length) : 0;
  document.getElementById('avgProjects').textContent = avg;
}

// Projects CRUD
function renderProjects() {
  const tbody = document.getElementById('projectTableBody');
  if (projects.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" class="empty-state">Belum ada data proyek</td></tr>';
    return;
  }
  
  tbody.innerHTML = projects.map(p => `
    <tr>
      <td>${p.month}</td>
      <td>${p.year}</td>
      <td>${p.count}</td>
      <td class="action-buttons">
        <button class="btn btn-warning btn-sm" onclick="editProject(${p.id})">Edit</button>
        <button class="btn btn-danger btn-sm" onclick="deleteProject(${p.id})">Hapus</button>
      </td>
    </tr>
  `).join('');
}

function openProjectModal() {
  document.getElementById('projectModalTitle').textContent = 'Tambah Proyek';
  document.getElementById('projectForm').reset();
  document.getElementById('projectId').value = '';
  document.getElementById('projectYear').value = new Date().getFullYear();
  document.getElementById('projectModal').classList.add('active');
}

function closeProjectModal() {
  document.getElementById('projectModal').classList.remove('active');
}

function saveProject(e) {
  e.preventDefault();
  
  const id = document.getElementById('projectId').value;
  const project = {
    id: id ? parseInt(id) : Date.now(),
    month: document.getElementById('projectMonth').value,
    year: parseInt(document.getElementById('projectYear').value),
    count: parseInt(document.getElementById('projectCount').value)
  };
  
  if (id) {
    const index = projects.findIndex(p => p.id === parseInt(id));
    projects[index] = project;
  } else {
    projects.push(project);
  }
  
  renderProjects();
  updateDashboard();
  initCharts(); // Update charts
  closeProjectModal();
}

function editProject(id) {
  const project = projects.find(p => p.id === id);
  document.getElementById('projectModalTitle').textContent = 'Edit Proyek';
  document.getElementById('projectId').value = project.id;
  document.getElementById('projectMonth').value = project.month;
  document.getElementById('projectYear').value = project.year;
  document.getElementById('projectCount').value = project.count;
  document.getElementById('projectModal').classList.add('active');
}

function deleteProject(id) {
  if (confirm('Yakin ingin menghapus data proyek ini?')) {
    projects = projects.filter(p => p.id !== id);
    renderProjects();
    updateDashboard();
    initCharts(); // Update charts
  }
}

// SDM CRUD
function renderSDM() {
  const tbody = document.getElementById('sdmTableBody');
  if (sdmData.length === 0) {
    tbody.innerHTML = '<tr><td colspan="5" class="empty-state">Belum ada data SDM</td></tr>';
    return;
  }
  
  tbody.innerHTML = sdmData.map(s => `
    <tr>
      <td>${s.name}</td>
      <td>${s.position}</td>
      <td><span style="color: ${s.status === 'Aktif' ? '#10b981' : '#ef4444'}">${s.status}</span></td>
      <td>${s.email}</td>
      <td class="action-buttons">
        <button class="btn btn-warning btn-sm" onclick="editSDM(${s.id})">Edit</button>
        <button class="btn btn-danger btn-sm" onclick="deleteSDM(${s.id})">Hapus</button>
      </td>
    </tr>
  `).join('');
}

function openSDMModal() {
  document.getElementById('sdmModalTitle').textContent = 'Tambah SDM';
  document.getElementById('sdmForm').reset();
  document.getElementById('sdmId').value = '';
  document.getElementById('sdmModal').classList.add('active');
}

function closeSDMModal() {
  document.getElementById('sdmModal').classList.remove('active');
}

function saveSDM(e) {
  e.preventDefault();
  
  const id = document.getElementById('sdmId').value;
  const sdm = {
    id: id ? parseInt(id) : Date.now(),
    name: document.getElementById('sdmName').value,
    position: document.getElementById('sdmPosition').value,
    status: document.getElementById('sdmStatus').value,
    email: document.getElementById('sdmEmail').value
  };
  
  if (id) {
    const index = sdmData.findIndex(s => s.id === parseInt(id));
    sdmData[index] = sdm;
  } else {
    sdmData.push(sdm);
  }
  
  renderSDM();
  updateDashboard();
  initCharts(); // Update charts
  closeSDMModal();
}

function editSDM(id) {
  const sdm = sdmData.find(s => s.id === id);
  document.getElementById('sdmModalTitle').textContent = 'Edit SDM';
  document.getElementById('sdmId').value = sdm.id;
  document.getElementById('sdmName').value = sdm.name;
  document.getElementById('sdmPosition').value = sdm.position;
  document.getElementById('sdmStatus').value = sdm.status;
  document.getElementById('sdmEmail').value = sdm.email;
  document.getElementById('sdmModal').classList.add('active');
}

function deleteSDM(id) {
  if (confirm('Yakin ingin menghapus data SDM ini?')) {
    sdmData = sdmData.filter(s => s.id !== id);
    renderSDM();
    updateDashboard();
  }
}

// Prediction
function calculatePrediction() {
  if (projects.length < 3) {
    alert('Minimal 3 data proyek diperlukan untuk prediksi');
    return;
  }
  
  const sortedProjects = [...projects].sort((a, b) => {
    if (a.year !== b.year) return a.year - b.year;
    const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
    return months.indexOf(a.month) - months.indexOf(b.month);
  });
  
  const last3 = sortedProjects.slice(-3);
  const prediction = Math.round((last3[0].count + last3[1].count + last3[2].count) / 3);
  
  const sdmPerProyek = parseInt(document.getElementById('sdmPerProyek').value);
  const kebutuhanSDM = prediction * sdmPerProyek;
  const currentSDM = sdmData.filter(s => s.status === 'Aktif').length;
  const gap = kebutuhanSDM - currentSDM;
  
  document.getElementById('predictionResult').innerHTML = `
    <div class="result-box">
      <h3>üìä Hasil Prediksi</h3>
      <div class="result-item">
        <strong>Prediksi Jumlah Proyek Bulan Berikutnya:</strong> ${prediction} proyek
      </div>
      <div class="result-item">
        <strong>Kebutuhan SDM:</strong> ${kebutuhanSDM} orang
      </div>
      <div class="result-item">
        <strong>SDM Aktif Saat Ini:</strong> ${currentSDM} orang
      </div>
      <div class="result-item">
        <strong>Gap SDM:</strong> <span style="color: ${gap > 0 ? '#ef4444' : '#10b981'}">${gap > 0 ? '+' : ''}${gap} orang</span>
      </div>
      <hr style="margin: 16px 0; border: none; border-top: 1px solid #e0e0e0;">
      <p style="margin-top: 16px; line-height: 1.6;">
        ${gap > 0 
          ? `‚ö†Ô∏è <strong>Rekomendasi:</strong> Sistem menyarankan untuk merekrut ${gap} SDM tambahan atau mengalokasikan SDM dari proyek lain untuk menghindari overload.` 
          : gap < 0 
          ? `‚úÖ <strong>Status:</strong> Kapasitas SDM mencukupi. Kelebihan ${Math.abs(gap)} SDM dapat dialokasikan untuk peningkatan kualitas atau proyek tambahan.`
          : `‚úÖ <strong>Status:</strong> Kapasitas SDM optimal untuk proyeksi proyek bulan depan.`
        }
      </p>
    </div>
  `;
}

// Reports
function generateReport() {
  const totalProjects = projects.reduce((sum, p) => sum + p.count, 0);
  const avgProjects = projects.length > 0 ? (totalProjects / projects.length).toFixed(1) : 0;
  const maxProject = projects.reduce((max, p) => p.count > max.count ? p : max, projects[0]);
  const minProject = projects.reduce((min, p) => p.count < min.count ? p : min, projects[0]);
  
  const positionCount = {};
  sdmData.forEach(s => {
    positionCount[s.position] = (positionCount[s.position] || 0) + 1;
  });
  
  const statusCount = {};
  sdmData.forEach(s => {
    statusCount[s.status] = (statusCount[s.status] || 0) + 1;
  });
  
  document.getElementById('reportContent').innerHTML = `
    <div class="result-box" style="margin-bottom: 20px;">
      <h3>üìà Laporan Data Proyek</h3>
      <table style="margin: 16px 0;">
        <tr>
          <td style="border: none; padding: 8px 16px 8px 0;"><strong>Total Proyek (Keseluruhan):</strong></td>
          <td style="border: none; padding: 8px 0;">${totalProjects} proyek</td>
        </tr>
        <tr>
          <td style="border: none; padding: 8px 16px 8px 0;"><strong>Rata-rata Proyek per Bulan:</strong></td>
          <td style="border: none; padding: 8px 0;">${avgProjects} proyek</td>
        </tr>
        <tr>
          <td style="border: none; padding: 8px 16px 8px 0;"><strong>Bulan Tertinggi:</strong></td>
          <td style="border: none; padding: 8px 0;">${maxProject.month} ${maxProject.year} (${maxProject.count} proyek)</td>
        </tr>
        <tr>
          <td style="border: none; padding: 8px 16px 8px 0;"><strong>Bulan Terendah:</strong></td>
          <td style="border: none; padding: 8px 0;">${minProject.month} ${minProject.year} (${minProject.count} proyek)</td>
        </tr>
      </table>
    </div>
    
    <div class="result-box" style="margin-bottom: 20px;">
      <h3>üë• Laporan SDM</h3>
      <table style="margin: 16px 0;">
        <tr>
          <td style="border: none; padding: 8px 16px 8px 0;"><strong>Total SDM:</strong></td>
          <td style="border: none; padding: 8px 0;">${sdmData.length} orang</td>
        </tr>
        <tr>
          <td style="border: none; padding: 8px 16px 8px 0;"><strong>SDM Aktif:</strong></td>
          <td style="border: none; padding: 8px 0;">${statusCount['Aktif'] || 0} orang</td>
        </tr>
        <tr>
          <td style="border: none; padding: 8px 16px 8px 0;"><strong>SDM Cuti:</strong></td>
          <td style="border: none; padding: 8px 0;">${statusCount['Cuti'] || 0} orang</td>
        </tr>
        <tr>
          <td style="border: none; padding: 8px 16px 8px 0;"><strong>SDM Tidak Aktif:</strong></td>
          <td style="border: none; padding: 8px 0;">${statusCount['Tidak Aktif'] || 0} orang</td>
        </tr>
      </table>
      
      <h4 style="margin-top: 24px; color: #667eea;">Distribusi Posisi:</h4>
      <ul style="margin-top: 12px; line-height: 2;">
        ${Object.entries(positionCount).map(([pos, count]) => 
          `<li>${pos}: <strong>${count} orang</strong></li>`
        ).join('')}
      </ul>
    </div>
    
    <div class="result-box">
      <h3>üí° Insight & Rekomendasi</h3>
      <ul style="margin-top: 12px; line-height: 2;">
        <li>Tren proyek menunjukkan ${maxProject.count > avgProjects * 1.2 ? 'fluktuasi tinggi' : 'stabilitas'} dalam ${projects.length} bulan terakhir</li>
        <li>Kapasitas SDM saat ini: ${sdmData.filter(s => s.status === 'Aktif').length} orang aktif</li>
        <li>Rasio SDM per proyek rata-rata: ${(sdmData.filter(s => s.status === 'Aktif').length / avgProjects).toFixed(2)} orang/proyek</li>
        <li>${statusCount['Aktif'] >= totalProjects * 2 ? '‚úÖ Kapasitas SDM mencukupi untuk volume proyek saat ini' : '‚ö†Ô∏è Pertimbangkan penambahan SDM untuk mengoptimalkan kinerja'}</li>
      </ul>
    </div>
    
    <div style="margin-top: 20px; padding: 16px; background: #f8f9fa; border-radius: 8px; text-align: center;">
      <small style="color: #666;">Laporan ini di-generate pada: ${new Date().toLocaleString('id-ID')}</small>
    </div>
  `;
}
</script>
</body>
</html>